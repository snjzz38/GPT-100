<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Humanize Any Text: GPT-100</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary: #1a4ab9;
            --bg: #f8fafc;
            --border: #d2d9e7;
            --text: #23272f;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 24px auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(26, 74, 185, 0.1);
            padding: 24px;
        }
        h1 {
            text-align: center;
            font-size: 1.6rem;
            margin-bottom: 8px;
        }
        .disclaimer {
            text-align: center;
            color: #64748b;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 16px;
        }
        select, button {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
            font-size: 0.95rem;
            background: #fff;
        }
        button {
            background: var(--primary);
            color: #fff;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover { background: #143c8f; }
        button:disabled {
            background: #a3b9e0;
            cursor: not-allowed;
        }
        .toggle {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .toggle input {
            width: 40px;
            height: 20px;
            appearance: none;
            background: #ccc;
            border-radius: 20px;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .toggle input::before {
            content: '';
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }
        .toggle input:checked {
            background: var(--primary);
        }
        .toggle input:checked::before { transform: translateX(20px); }
        .areas {
            display: flex;
            gap: 16px;
            flex-direction: column;
        }
        @media (min-width: 768px) {
            .areas { flex-direction: row; }
        }
        .area { flex: 1; }
        .area-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .area-header label {
            font-weight: 600;
            color: var(--primary);
        }
        .area-header button {
            background: #64748b;
            padding: 4px 10px;
            font-size: 0.85rem;
        }
        .area-header button:hover { background: #475569; }
        textarea {
            width: 100%;
            min-height: 250px;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: #f8fafc;
            font-family: 'Fira Mono', monospace;
            font-size: 0.9rem;
            resize: vertical;
        }
        textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(26, 74, 185, 0.2);
        }
        .word-count {
            font-size: 0.85rem;
            color: #64748b;
            text-align: right;
            margin-top: 4px;
        }
        .progress {
            width: 100%;
            height: 4px;
            background: var(--border);
            border-radius: 4px;
            margin: 16px 0;
            overflow: hidden;
            display: none;
        }
        .progress-bar {
            height: 100%;
            background: var(--primary);
            border-radius: 4px;
            width: 0;
            transition: width 0.4s ease-out;
        }
        .status {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 8px;
            text-align: center;
            height: 1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="font-size:60px;">GPT-100</h1>
        <p class="disclaimer"><b style="font-size:24px;">Humanize any AI-generated text.</b> <br><br>
             Still in beta development, expect lots of mistakes. 
             <br>May change/destroy facts, omit random information, make grammatical mistakes, etc. <br><br><b style="font-size:24px">ALWAYS CHECK!!!</b>
             <br><br>
        <div class="controls">
            <select id="tone">
                <option value="professional">Professional</option>
                <option value="academic">Academic</option>
                <option value="casual">Casual</option>
            </select>
            <div class="toggle">
                <span>General</span>
                <input type="checkbox" id="perspective" checked>
                <span>Personal</span>
            </div>
            <button id="process">Humanize Text</button>
        </div>
        <div class="areas">
            <div class="area">
                <div class="area-header">
                    <label for="input">Input Text</label>
                </div>
                <textarea id="input" placeholder="Paste your AI-generated text here, with paragraphs separated by newlines..."></textarea>
                <div class="word-count" id="input-count">0 words</div>
            </div>
            <div class="area">
                <div class="area-header" id="area-header-output">
                    <label for="output">Humanized Output</label>
                    <button id="copy">Copy</button>
                </div>
                <textarea id="output" readonly></textarea>
                <div class="word-count" id="output-count">0 words</div>
            </div>
        </div>
        <div class="progress"><div class="progress-bar"></div></div>
        <div class="status" id="status"></div>
    </div>
<script>
const $=id=>document.getElementById(id);
const MODELS_TO_TRY=['llama-3.1-8b-instant','llama3-8b-8192','gemma2-9b-it','mistral-saba-24b','llama3-70b-8192','meta-llama/llama-4-maverick-17b-128e-instruct','meta-llama/llama-4-scout-17b-16e-instruct','meta-llama/llama-guard-4-12b','llama-guard-3-8b','meta-llama/llama-prompt-guard-2-22m','meta-llama/llama-prompt-guard-2-86m'];
const FORBIDDEN_WORDS_COMPREHENSIVE=[/* List truncated for brevity */];
const COMMON_WORDS = new Set(['the','be','to','of','and','a','in','that','have','I','it','for','not','on','with','he','as','you','do','at','this','but','his','by','from','they','we','say','her','she','or','an','will','my','one','all','would','there','their','what','so','up','out','if','about','who','get','which','go','me','when','make','can','like','time','no','just','him','know','take','person','into','year','your','good','some','could','them','see','other','than','then','now','look','only','come','its','over','think','also','back','after','use','two','how','our','work','first','well','way','even','new','want','because','any','these','give','day','most','us']);
const PROPER_NOUNS=new Set(['climate change','ipcc','paris agreement']);

const apiCall=async(prompt,i=0,temp=1.9,retry=0)=>{
    if(i>=MODELS_TO_TRY.length)throw new Error('All models failed.');
    const m=MODELS_TO_TRY[i];
    try{
        const r=await fetch('/api/proxy',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:m,messages:[{role:'user',content:prompt}],temperature:temp,top_p:.98,max_tokens:2048})});
        const d=await r.json();
        if(!r.ok){
            const e=d.error||'Unknown error';
            if(e.includes('maximum context length'))return apiCall(prompt,i+1,temp,0);
            if(r.status===429){await new Promise(res=>setTimeout(res,3000));return apiCall(prompt,i+1,temp,0);}
            if(r.status>=500||r.status===404||r.status===403){
                if(retry<2){await new Promise(res=>setTimeout(res,1500*(retry+1)));return apiCall(prompt,i,temp,retry+1);}
                return apiCall(prompt,i+1,temp,0);
            }
            throw new Error(e);
        }
        return d.choices?.[0]?.message?.content.trim()||null;
    }catch(e){
        if(retry<2){await new Promise(res=>setTimeout(res,1500*(retry+1)));return apiCall(prompt,i,temp,retry+1);}
        return apiCall(prompt,i+1,temp,0);
    }
};

const enforceForbiddenWords = text => {
    let c=text;
    FORBIDDEN_WORDS_COMPREHENSIVE.forEach(w=>{
        if(PROPER_NOUNS.has(w.toLowerCase()))return;
        const r=new RegExp(`\\b${w}\\b`,'gi');
        c=c.replace(r,`[REPLACED WORD: ${w.toUpperCase()}]`);
    });
    return c;
};

// FINAL PASS: Remove all AI comments and fix grammar/spelling on the entire output (no meaning change)
async function finalGrammarCleanup(text) {
    const prompt = `
You are an expert editor for humanizing AI-generated text.

TASK: Remove all AI comments (such as "here is the rewritten text", "here is the revised section", "section 3:", etc.), remove any participial phrases at the start of sentences, and correct all grammar, spelling, or punctuation mistakes. Use only conventional punctuation (.,!?). Do NOT change the meaning, facts, or keywords (like "Climate Change", "IPCC", "Paris Agreement") of the text, and do NOT replace or omit any proper nouns. Do not add or remove sentences. Return only the fixed, clean text in a single paragraph, no commentary or section labels.

TEXT TO FIX:
"""${text}"""
`;
    let cleaned = '';
    try {
        cleaned = await apiCall(prompt, 0, 0.1);
        cleaned = sanitizeAIOutput(cleaned);
    } catch {
        cleaned = text;
    }
    return cleaned;
}

const processText = async () => {
    const text = $('input').value.trim();
    if(!text){alert('Please enter text to humanize.');return;}
    const processBtn=$('process'),progressContainer=document.querySelector('.progress'),progressBar=document.querySelector('.progress-bar'),statusEl=$('status'),outputEl=$('output');
    processBtn.disabled=true;processBtn.textContent='Processing...';progressContainer.style.display='block';progressBar.style.width='0%';statusEl.textContent='Initializing...';outputEl.value='';
    try{
        const tone=$('tone').value,isPersonal=$('perspective').checked,allSectionsDict=splitInputToSectionDict(text),sectionNames=Object.keys(allSectionsDict),finalHumanizedSections=[];
        for(let i=0;i<sectionNames.length;i++){
            const sectionKey=sectionNames[i],originalSectionContent=allSectionsDict[sectionKey];
            let humanizedContent = await apiCall(buildComprehensivePrompt(sectionKey, allSectionsDict, originalSectionContent, tone, isPersonal, finalHumanizedSections, {}), 0, 1.9);
            if(!humanizedContent || isNonsense(humanizedContent)){
                humanizedContent = originalSectionContent; // Fallback
            }
            humanizedContent = enforceForbiddenWords(humanizedContent);
            finalHumanizedSections.push(humanizedContent);
        }
        statusEl.textContent='Cleaning up any leftover AI comments and fixing grammar...';
        let cleanedText = await finalGrammarCleanup(finalHumanizedSections.join('\n\n'));
        cleanedText = cleanedText.replace(/\n{2,}/g,'\n\n').trim();
        outputEl.value=cleanedText;
        const finalWords=outputEl.value.trim().match(/\S+/g)||[];$('output-count').textContent=`${finalWords.length} words`;
        progressBar.style.width='100%';
        statusEl.textContent='Humanization complete!';
    }catch(error){
        outputEl.value=`Error: ${error.message}`;
        statusEl.textContent=`Failed: ${error.message.substring(0,100)}...`;
    }finally{
        setTimeout(()=>{
            progressContainer.style.display='none';processBtn.disabled=false;processBtn.textContent='Humanize Text';
            if(!statusEl.textContent.startsWith('Failed:'))statusEl.textContent='';
        },2000);
    }
};

document.addEventListener('DOMContentLoaded',()=>{
    const processButton=$('process');
    ['input','output'].forEach(id=>{
        const el=$(id),counter=$(`${id}-count`);
        const updateCount=()=>{const words=el.value.trim().match(/\S+/g)||[];counter.textContent=`${words.length} words`;};
        el.addEventListener('input',updateCount);
        updateCount();
    });
    processButton.addEventListener('click',processText);
});
</script>
</body>
</html>
