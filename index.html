<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Text Humanizer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{--primary:#1a4ab9;--bg:#f8fafc;--border:#d2d9e7;--text:#23272f}
*{box-sizing:border-box}
body{font-family:'Segoe UI',Arial;margin:0;background:var(--bg);color:var(--text);min-height:100vh}
.container{max-width:1000px;margin:24px auto;background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(26,74,185,0.1);padding:24px}
h1{text-align:center;font-size:1.6rem;margin-bottom:8px}
.disclaimer{text-align:center;color:#64748b;font-size:0.9rem;margin-bottom:20px}
.controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:16px}
select,button{padding:8px 16px;border-radius:8px;border:1px solid var(--border);font-size:0.95rem}
select{background:#f5f7fa}
button{background:var(--primary);color:#fff;border:none;font-weight:600;cursor:pointer}
button:hover{background:#143c8f}
button:disabled{background:#7abaff;cursor:not-allowed}
.toggle{display:flex;align-items:center;gap:8px}
.toggle input{width:40px;height:20px;appearance:none;background:#ccc;border-radius:20px;position:relative;cursor:pointer}
.toggle input:checked{background:var(--primary)}
.toggle input::before{content:'';width:16px;height:16px;background:#fff;border-radius:50%;position:absolute;top:2px;left:2px;transition:0.3s}
.toggle input:checked::before{left:22px}
.areas{display:flex;gap:16px;flex-direction:column}
@media(min-width:768px){.areas{flex-direction:row}}
.area{flex:1}
.area label{font-weight:600;color:var(--primary);display:block;margin-bottom:8px}
textarea{width:100%;min-height:200px;padding:10px;border:1px solid var(--border);border-radius:8px;background:#f5f7fa;font-family:'Fira Mono',monospace;font-size:0.9rem;resize:vertical}
textarea:focus{border-color:var(--primary);outline:none}
.word-count{font-size:0.85rem;color:#64748b;text-align:right;margin-top:4px}
.progress{width:100%;height:4px;background:var(--border);border-radius:4px;margin:16px 0;display:none}
.progress-bar{height:100%;background:var(--primary);border-radius:4px;width:0;transition:width 0.3s}
.copy-btn{background:#64748b;padding:6px 12px;font-size:0.85rem;margin-left:8px}
.copy-btn:hover{background:#475569}
</style>
</head>
<body>
<div class="container">
  <h1>AI Text Humanizer</h1>
  <p class="disclaimer">Beta version - expect some grammatical errors. Use grammar tools for final polish.</p>
  
  <div class="controls">
    <select id="tone">
      <option value="professional">Professional</option>
      <option value="academic">Academic</option>
      <option value="casual">Casual</option>
    </select>
    <div class="toggle">
      <span>General</span>
      <input type="checkbox" id="perspective" checked>
      <span>Personal</span>
    </div>
    <button id="process">Humanize Text</button>
  </div>


  <div class="areas">
    <div class="area">
      <label>Input Text</label>
      <textarea id="input" placeholder="Paste your text here..."></textarea>
      <div class="word-count" id="input-count">0 words</div>
    </div>
    <div class="area">
      <label>Humanized Output <button class="copy-btn" id="copy">Copy</button></label>
      <textarea id="output" readonly></textarea>
      <div class="word-count" id="output-count">0 words</div>
    </div>
  </div>


  <div class="progress"><div class="progress-bar"></div></div>
</div>


<script>
 let apikey = "";
  async function getApiKey() {
    const res = await fetch('/api/key');
    const data = await res.json();
    apikey = data.apiKey;
    console.log("Key loaded securely.");
  }More actions
getApiKey();


const els = {
  input: document.getElementById('input'),
  output: document.getElementById('output'),
  tone: document.getElementById('tone'),
  perspective: document.getElementById('perspective'),
  process: document.getElementById('process'),
  copy: document.getElementById('copy'),
  progress: document.querySelector('.progress'),
  progressBar: document.querySelector('.progress-bar'),
  inputCount: document.getElementById('input-count'),
  outputCount: document.getElementById('output-count')
};


// Word frequency list (common words have lower scores)
const commonWords = new Set([
  'the', 'be', 'to', 'of', 'and', 'a', 'in', 'that', 'have', 'i', 'it', 'for', 'not', 'on', 'with', 'he', 'as', 'you', 'do', 'at',
  'this', 'but', 'his', 'by', 'from', 'they', 'she', 'or', 'an', 'will', 'my', 'one', 'all', 'would', 'there', 'their', 'what',
  'so', 'up', 'out', 'if', 'about', 'who', 'get', 'which', 'go', 'me', 'when', 'make', 'can', 'like', 'time', 'no', 'just',
  'him', 'know', 'take', 'people', 'into', 'year', 'your', 'good', 'some', 'could', 'them', 'see', 'other', 'than', 'then',
  'now', 'look', 'only', 'come', 'its', 'over', 'think', 'also', 'back', 'after', 'use', 'two', 'how', 'our', 'work', 'first',
  'well', 'way', 'even', 'new', 'want', 'because', 'any', 'these', 'give', 'day', 'most', 'us', 'is', 'was', 'are', 'been',
  'has', 'had', 'were', 'said', 'each', 'which', 'she', 'do', 'how', 'their', 'if', 'will', 'up', 'other', 'about', 'out',
  'many', 'then', 'them', 'these', 'so', 'some', 'her', 'would', 'make', 'like', 'into', 'him', 'time', 'has', 'two', 'more',
  'very', 'what', 'know', 'just', 'first', 'get', 'over', 'think', 'where', 'much', 'go', 'well', 'were', 'been', 'through',
  'when', 'who', 'oil', 'sit', 'but', 'now'
]);


function calculateWordComplexity(word) {
  const cleanWord = word.toLowerCase().replace(/[^a-z]/g, '');
  if (!cleanWord || cleanWord.length < 2) return 0;
  
  let score = 0;
  
  // Length score (0-3 points)
  if (cleanWord.length <= 3) score += 0;
  else if (cleanWord.length <= 5) score += 1;
  else if (cleanWord.length <= 7) score += 2;
  else score += 3;
  
  // Frequency score (0-3 points)
  if (commonWords.has(cleanWord)) score += 0;
  else if (cleanWord.length <= 4) score += 1;
  else if (cleanWord.length <= 6) score += 2;
  else score += 3;
  
  // Complexity patterns (0-4 points)
  const complexPatterns = [
    /tion$/, /sion$/, /ment$/, /ness$/, /ical$/, /eous$/, /ious$/, /able$/, /ible$/,
    /ize$/, /ise$/, /fy$/, /ate$/, /ive$/, /ous$/, /ful$/, /less$/, /ward$/, /wise$/
  ];
  
  let patternCount = complexPatterns.filter(pattern => pattern.test(cleanWord)).length;
  score += Math.min(patternCount, 4);
  
  return Math.min(score, 10);
}


async function getSynonyms(word) {
  try {
    const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
    if (!response.ok) return [];
    
    const data = await response.json();
    const synonyms = new Set();
    
    data.forEach(entry => {
      entry.meanings?.forEach(meaning => {
        meaning.synonyms?.forEach(syn => {
          if (syn && syn !== word && syn.length > 1) {
            synonyms.add(syn.toLowerCase());
          }
        });
      });
    });
    
    return Array.from(synonyms);
  } catch {
    return [];
  }
}


async function analyzeAndReplaceWords(text) {
  const words = text.match(/\b[a-zA-Z]+\b/g) || [];
  const wordAnalysis = [];
  
  const uniqueWords = [...new Set(words.map(w => w.toLowerCase()))];
  
  for (let word of uniqueWords) {
    const complexity = calculateWordComplexity(word);
    if (complexity >= 6) {
      const synonyms = await getSynonyms(word);
      if (synonyms.length > 0) {
        const simpleSynonym = synonyms.reduce((a, b) => 
          calculateWordComplexity(a) < calculateWordComplexity(b) ? a : b
        );
        wordAnalysis.push({
          word,
          complexity,
          synonym: simpleSynonym
        });
      }
    }
  }
  
  wordAnalysis.sort((a, b) => b.complexity - a.complexity);
  
  let result = text;
  wordAnalysis.slice(0, 8).forEach(analysis => {
    const regex = new RegExp(`\\b${analysis.word}\\b`, 'gi');
    result = result.replace(regex, analysis.synonym);
  });
  
  return result;
}


function updateCount(textarea, counter) {
  const words = textarea.value.trim().split(/\s+/).filter(w => w).length;
  counter.textContent = `${words} words`;
}


function getRandomTemperature() {
  return (Math.random() * (1.7 - 0.7) + 0.7).toFixed(2);
}


async function makeApiCall(prompt, wordCount) {
  try {
    const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${apiKey}`
      },
      body: JSON.stringify({
        model: 'llama-3.1-8b-instant',
        messages: [{role: 'user', content: prompt}],
        max_tokens: wordCount * 3,
        temperature: parseFloat(getRandomTemperature())
      })
    });
    
    if (response.ok) {
      const data = await response.json();
      return data.choices[0].message.content.trim();
    }
    return null;
  } catch {
    return null;
  }
}


async function processText(text, tone, isPersonal) {
  const sections = text.split(/\n\s*\n/).filter(s => s.trim());
  const results = [];
  
  for (let i = 0; i < sections.length; i++) {
    const section = sections[i];
    const wordCount = section.split(/\s+/).length;
    
    els.progressBar.style.width = `${10 + (i / sections.length) * 25}%`;
    
    const prompt1 = `Rewrite this text in ${tone} tone${isPersonal ? ' using first person' : ''}. 
    Use simple, common words and varied sentence structures. Output exactly ${wordCount} words (±2).
    Avoid hyphens (—). No comments or explanations, just the rewritten text.
    
    Text: "${section}"`;
    
    let firstResult = await makeApiCall(prompt1, wordCount);
    if (!firstResult) firstResult = section;
    
    els.progressBar.style.width = `${35 + (i / sections.length) * 25}%`;
    
    const simplifiedText = await analyzeAndReplaceWords(firstResult);
    
    els.progressBar.style.width = `${60 + (i / sections.length) * 35}%`;
    
    const prompt2 = `Rewrite this text to sound natural and human-like. 
    Use simple, direct sentences. Avoid:
    - Past participial phrases (e.g., "Tired from the flight, she slept.")
    - Present participial phrases (e.g., "The school was renovated, making it nicer.")
    Keep ${tone} tone and ${wordCount} words (±2). No comments or explanations, just the text.
    
    Text: "${simplifiedText}"`;
    
    let finalResult = await makeApiCall(prompt2, wordCount);
    if (!finalResult) finalResult = simplifiedText;
    
    results.push(finalResult);
  }
  
  return results.join('\n\n');
}


els.input.addEventListener('input', () => updateCount(els.input, els.inputCount));
els.output.addEventListener('input', () => updateCount(els.output, els.outputCount));


els.copy.addEventListener('click', () => {
  els.output.select();
  document.execCommand('copy');
  els.copy.textContent = 'Copied!';
  setTimeout(() => els.copy.textContent = 'Copy', 1000);
});


els.process.addEventListener('click', async () => {
  const text = els.input.value.trim();
  if (!text) {
    els.output.value = 'Please enter text to process.';
    return;
  }
  
  els.process.disabled = true;
  els.process.textContent = 'Processing...';
  els.progress.style.display = 'block';
  els.progressBar.style.width = '10%';
  
  const result = await processText(text, els.tone.value, els.perspective.checked); // Fixed typo here
  
  els.progressBar.style.width = '100%';
  els.output.value = result;
  updateCount(els.output, els.outputCount);
  
  setTimeout(() => {
    els.progress.style.display = 'none';
    els.process.disabled = false;
    els.process.textContent = 'Humanize Text';
  }, 500);
});
</script>
</body>
</html>



